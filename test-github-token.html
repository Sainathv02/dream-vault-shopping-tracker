<!DOCTYPE html>
<html>
<head>
    <title>GitHub Token Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 600px; margin: 0 auto; }
        input, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #333; }
        input { background: #2a2a2a; color: white; width: 400px; }
        button { background: #0066cc; color: white; cursor: pointer; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background: #1a4a1a; border: 1px solid #4caf50; }
        .error { background: #4a1a1a; border: 1px solid #f44336; }
        pre { background: #0a0a0a; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß GitHub Token Tester</h1>
        <p>Test your GitHub token before using it in Dream Vault:</p>
        
        <div>
            <input type="password" id="token" placeholder="Paste your GitHub token here (ghp_...)" />
            <button onclick="testToken()">Test Token</button>
        </div>
        
        <div id="result"></div>
        
        <div style="margin-top: 30px; padding: 15px; background: #2a2a2a; border-radius: 5px;">
            <h3>‚úÖ What This Tests:</h3>
            <ul>
                <li>Token validity and authentication</li>
                <li>User information access</li>
                <li>Repository creation permissions</li>
                <li>API rate limits</li>
            </ul>
        </div>
    </div>

    <script>
        async function testToken() {
            const token = document.getElementById('token').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!token) {
                resultDiv.innerHTML = '<div class="result error">Please enter a token</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="result">Testing token...</div>';
            
            try {
                // Test 1: Basic authentication
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'Dream-Vault-Token-Test'
                    }
                });
                
                if (!userResponse.ok) {
                    throw new Error(`Authentication failed: ${userResponse.status} ${userResponse.statusText}`);
                }
                
                const user = await userResponse.json();
                
                // Test 2: Check scopes
                const scopes = userResponse.headers.get('X-OAuth-Scopes') || '';
                
                let result = `
                    <div class="result success">
                        <h3>‚úÖ Token Test Successful!</h3>
                        <pre><strong>User:</strong> ${user.login}
<strong>Name:</strong> ${user.name || 'Not set'}
<strong>Account Type:</strong> ${user.type}
<strong>Token Scopes:</strong> ${scopes}
<strong>Rate Limit Remaining:</strong> ${userResponse.headers.get('X-RateLimit-Remaining') || 'Unknown'}

<strong>‚úÖ Ready to use in Dream Vault!</strong></pre>
                    </div>
                `;
                
                // Check for required scopes
                if (!scopes.includes('repo') && !scopes.includes('public_repo')) {
                    result += `
                        <div class="result error">
                            <h3>‚ö†Ô∏è Missing Required Scopes</h3>
                            <p>Your token needs either <strong>repo</strong> (for private repos) or <strong>public_repo</strong> (for public repos) scope.</p>
                            <p>Current scopes: ${scopes || 'None detected'}</p>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Token Test Failed</h3>
                        <pre>${error.message}</pre>
                        <h4>Common Issues:</h4>
                        <ul>
                            <li>Token is expired or invalid</li>
                            <li>Token missing required scopes (repo/public_repo)</li>
                            <li>Network connectivity issues</li>
                            <li>GitHub API rate limits</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // Allow Enter key to test
        document.getElementById('token').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testToken();
            }
        });
    </script>
</body>
</html>
